{% extends 'core/base.html' %}
{% load static %}

{% block title %}Track Order | MediCare+{% endblock %}

{% block content %}

<!-- Tracking Section -->
<section id="tracking-section" class="section">
    <div id="tracking-container" class="container">
        <h2 id="tracking-title" class="section-title">Track Your Order</h2>
        <p id="tracking-subtitle" class="section-subtitle">Enter your order ID to track delivery status</p>

        <!-- Tracking Search -->
        <div id="tracking-search" class="tracking-search">
            <form id="tracking-form" class="form" method="get" action="{% url 'tracking' %}">
                <div class="tracking-input-group">
                    <input id="order-id" name="order_id" type="text" placeholder="Enter Order ID (e.g., ORD123456)" required />
                    <button id="track-submit" type="submit" class="btn btn-primary">Track Order</button>
                </div>
            </form>
        </div>

        <!-- Tracking Results -->
        <div id="tracking-results" class="tracking-results" {% if not order %}style="display:none;"{% endif %}>
            <div id="order-info-card" class="order-info-card">
                <div id="order-header" class="order-header">
                    <div>
                        <h3 id="order-number">Order #{{ order.order_id|default:"ORD123456" }}</h3>
                        <p id="order-placed">Placed on {{ order.placed_on|date:"F j, Y" }}</p>
                    </div>
                    <div id="order-status" class="order-status {% if order.status == 'in_transit' %}status-in-transit{% endif %}">
                        {{ order.get_status_display|default:"In Transit" }}
                    </div>
                </div>

                <div id="order-details" class="order-details">
                    <div class="detail-item">
                        <strong>Estimated Delivery:</strong>
                        <span id="estimated-delivery">{{ order.estimated_delivery|date:"F j, Y" }}</span>
                    </div>
                    <div class="detail-item">
                        <strong>Delivery Address:</strong>
                        <span id="delivery-address">{{ order.delivery_address|default:"123 Main Street, New York, NY 10001" }}</span>
                    </div>
                </div>
            </div>

            <!-- Tracking Timeline -->
            <div id="tracking-timeline" class="tracking-timeline">
                {% if timeline %}
                    {% for item in timeline %}
                        <div class="timeline-item {% if item.completed %}completed{% elif item.active %}active{% endif %}">
                            <div class="timeline-icon">{{ item.icon }}</div>
                            <div class="timeline-content">
                                <h4>{{ item.title }}</h4>
                                <p class="timeline-time">{{ item.date }}</p>
                                {% if item.note %}<p>{{ item.note }}</p>{% endif %}
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <!-- example static timeline -->
                    <div class="timeline-item completed">
                        <div class="timeline-icon">âœ“</div>
                        <div class="timeline-content">
                            <h4>Order Placed</h4>
                            <p>November 28, 2025 - 10:30 AM</p>
                            <p>Your order has been received</p>
                        </div>
                    </div>

                    <div class="timeline-item completed">
                        <div class="timeline-icon">âœ“</div>
                        <div class="timeline-content">
                            <h4>Order Confirmed</h4>
                            <p>November 28, 2025 - 11:00 AM</p>
                            <p>Pharmacist verified your prescription</p>
                        </div>
                    </div>

                    <div class="timeline-item completed">
                        <div class="timeline-icon">âœ“</div>
                        <div class="timeline-content">
                            <h4>Order Packed</h4>
                            <p>November 29, 2025 - 09:15 AM</p>
                            <p>Your medicines have been packed</p>
                        </div>
                    </div>

                    <div class="timeline-item active">
                        <div class="timeline-icon">ðŸšš</div>
                        <div class="timeline-content">
                            <h4>Out for Delivery</h4>
                            <p>November 30, 2025 - 08:00 AM</p>
                            <p>Your order is on the way</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-icon">ðŸ“¦</div>
                        <div class="timeline-content">
                            <h4>Delivered</h4>
                            <p>Pending</p>
                        </div>
                    </div>
                {% endif %}
            </div>

            <!-- Delivery Person Info -->
            <div id="delivery-info-card" class="delivery-info-card">
                <h3>Delivery Person Details</h3>
                <div id="delivery-person" class="delivery-person">
                    <div id="delivery-person-avatar" class="delivery-person-avatar">ðŸ‘¤</div>
                    <div id="delivery-person-details" class="delivery-person-details">
                        <h4 id="delivery-person-name">{{ delivery.name|default:"John Delivery" }}</h4>
                        <p id="delivery-role">{{ delivery.role|default:"Delivery Agent" }}</p>
                        <p id="delivery-phone">ðŸ“ž {{ delivery.phone|default:"+1-555-0123" }}</p>
                    </div>
                    <a id="delivery-call" href="tel:{{ delivery.phone|default:'+15550123' }}" class="btn btn-secondary">Call Now</a>
                </div>
            </div>

            <!-- Order Items -->
            <div id="order-items-card" class="order-items-card">
                <h3>Order Items</h3>

                {% if items %}
                    {% for it in items %}
                        <div class="order-item">
                            <div class="order-item-icon">ðŸ’Š</div>
                            <div class="order-item-details">
                                <h4>{{ it.name }}</h4>
                                <p>Quantity: {{ it.quantity }}</p>
                            </div>
                            <div class="order-item-price">{{ it.price|floatformat:2 }}</div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="order-item">
                        <div class="order-item-icon">ðŸ’Š</div>
                        <div class="order-item-details">
                            <h4>Paracetamol 500mg</h4>
                            <p>Quantity: 1</p>
                        </div>
                        <div class="order-item-price">$12.99</div>
                    </div>

                    <div class="order-item">
                        <div class="order-item-icon">ðŸ’Š</div>
                        <div class="order-item-details">
                            <h4>Vitamin D3</h4>
                            <p>Quantity: 2</p>
                        </div>
                        <div class="order-item-price">$49.98</div>
                    </div>
                {% endif %}

                <div id="order-total" class="order-total">
                    <span>Total Amount:</span>
                    <span id="order-total-amount">
                        {% if total %}{{ total|floatformat:2 }}{% else %}$67.97{% endif %}
                    </span>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}